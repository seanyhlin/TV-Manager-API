<!DOCTYPE html>
<html>
  <head>
    <title>TV Manager API</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            async class='remove'></script>
    <script class="remove">
      var respecConfig = {
        specStatus:          "unofficial", // "ED",
        shortName:           "TV Manager API", // needed for generated URLs
        editors: [{
          name: "Sean Lin",
          company: "Mozilla",
          companyURL: "http://www.mozilla.org",
          mailto: "selin@mozilla.com"
        }, {
          name: "Gary Chen (PoYu Chen)",
          company: "Mozilla",
          companyURL: "http://www.mozilla.org",
          mailto: "gchen@mozilla.com"
        }, {
          name: "Gene Lian",
          company: "Mozilla",
          companyURL: "http://www.mozilla.org",
          note: "Former"
        }],
        publishDate:         "", // no needed for "ED" or "unofficial"
        edDraftURI:          "http://seanyhlin.github.io/TV-Manager-API/index.html", // needed for "ED"
        previousPublishDate: "", // needed for "WD", "LC", "CR"
        previousMaturity:    "", // needed for "WD", "LC", "CR"
        lcEnd:               "", // needed for "LC"
        crEnd:               "", // needed for "CR"
        // wg:           "System Applications Working Group",
        // wgURI:        "http://www.w3.org/2012/sysapps/",
        // wgPublicList: "public-sysapps",
        // wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/43696/status",
        otherLinks: [{
          key: "Repository",
          data: [{
            value: "We are on GitHub.",
            href: "https://github.com/seanyhlin/TV-Manager-API/"
          }, {
            value: "File a bug.",
            href: "https://github.com/seanyhlin/TV-Manager-API/issues"
          }, {
            value: "Commit history.",
            href: "https://github.com/seanyhlin/TV-Manager-API/commits/gh-pages"
          }]
        }],
        inlineCSS:    true,
        noIDLIn:      true,
        noIDLSorting: true
      };
    </script>
  </head>

<!-----------------------------------------------------------------------------
Style guide to contributors:
============================
- this document uses ReSpec, see
  http://dev.w3.org/2009/dap/ReSpec.js/documentation.html
- use 80 characters wide lines, whenever possible (except long links)
- keep sections 2 empty lines apart
- put comments in front of sections, for better readability with syntax coloring
  editors
- use indentation with care: it may improve readability, but at the expense of
  line lenght
- when descriptions of attributes is short, use the <dd> elements even when
  the text also contains conformance statements (e.g. MUST, SHOULD, MAY).
  No use repeating the same information in a separate paragraph.
------------------------------------------------------------------------------>
 
  <body>

<!-- - - - - - - - - - - - - - - Abstract  - - - - - - - - - - - - - - - - - -->    
    <section id="abstract">
      The TV Manager API allows an application to manage the TV device.
    </section>

<!-- - - - - - - - - - - - - - - Status of this document - - - - - - - - - - -->   
    <section id="sotd">
    </section>
    
<!-- - - - - - - - - - - - - - - Introduction  - - - - - - - - - - - - - - - -->
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        TV Manager API enables the development of web-based applications to
        acquire the information from service providers as well as to manage the
        native TV hardwares (i.e. tuners).
      </p>

      <section>
        <h3>Use Cases</h3>
        <p>
          The TV Manager API is aimed to cover the following use cases:
        </p>
        <ul>
          <li>
            The web content is able to know the number of tuners on the device,
            and the broadcasting types (DVB-T, DVB-S, etc.) supported by each of
            them.
          </li>
          <li>
            The TV tuner, which may have its own scanning algorithm provided by
            the vendor, can scan broadcasting channels. The scanning status and
            the information of discovered channels are exposed to the web
            content.
          </li>
          <li>
            The web content is able to control/select TV channels with the tuner
            on the device.
          </li>
          <li>
            The web content is able to receive the information of Electronic
            Program Guide (EPG) as well as the dynamic updates provided by
            broadcasters/service providers.
          </li>
          <li>
            A TV program may have multiple video/audio tracks in the same
            broadcasting stream.
          </li>
          <li>
            The web content may flexibly manipulate multiple tuners. For
            example, it may only consume one tuner for watching and recording a
            given channel at the same time. Yet when it comes to switch to
            another channel to watch, in order not to affect the original
            recording task against the tuner, the app may take another tuner to
            do so, if resource permitted.
          </li>
          <li>
            The web content may play the broadcasting stream content while
            browsing through the list of other currently broadcasted programs.
          </li>
          <li>
            The web content is able to suffice the scenarios of concurrently
            displaying multiple streams (i.e. Picture-in-Picture).
          </li>
          <li>
            The web content can receive emergency announcements for earthquake,
            tsunami, fire, etc.
          </li>
        </ul>
      </section>

      <section>
        <h3>Interfaces UML diagram</h3>
        <p>
          <a href="assets/images/tv-manager-api.png" target="_blank">
            <img width="100%" src="assets/images/tv-manager-api.png" 
            alt="TV Manager API interfaces UML diagram" 
            title="TV Manager API interfaces UML diagram">
          </a>
        </p>
      </section>

      <section>
        <h3>Examples</h3>
        <p>
          If an application has the privilege to use the TV Manager API, it can
          use a bunch of basic methods defined in the <a>TVManager</a> to
          manage the TV device.
        </p>

        <p>
          The following example shows how to get all the available TV tuners on
          the TV device, and how to set the current source and listen to events
          for source changes.
        </p>

        <pre class="example highlight">
          // Retrieve all the available TV tuners.
          navigator.tv.getTuners().then(function onsuccess(tuners) {
            // Just use the first TV tuner.
            var tuner = tuners[0];

            // Set the 'oncurrentsourcechanged' event handler.
            tuner.oncurrentsourcechanged = function oncurrentsourcechanged(event) {
              alert("The current TV source has changed.");
            };

            // Get the supported TV source types for the TV tuner. 
            var sourceTypes = tuner.getSupportedSourceTypes();

            // Just use the first TV source type.
            tuner.setCurrentSource(sourceTypes[0]).then(function onsuccess() {
              alert("Succeeded to set the TV source.");
            }, function onerror(error) {
              alert(error);
            });
          }, function onerror(error) {
            alert(error);
          });
        </pre>

        <p>
          The following example shows how to scan and get all the available TV
          channels from a configured TV source of the TV tuner.
        </p>

        <pre class="example highlight">
          // Assuming a tuner has already been picked and its current source is
          // set, variable |currentSource| is used for following illustration.

          if (currentSource.isScanning) {
            return;
          }

          // Set the 'onscanningstatechanged' event handler.
          currentSource.onscanningstatechanged = function onscanningstatechanged(event) {
            var state = event.state;

            switch (state) {
              case "cleared":
                alert("All the TV channels are cleared for rescanning.");
                break;
              case "scanned":
                alert("A new TV channel is scanned: " + event.channel.name);
                break;
              case "completed":
                alert("The scanning process is completed.");

                // Retrieve all the available TV channels from the configured
                // TV source of the TV tuner.
                currentSource.getChannels().then(function onsuccess(channels) {
                  alert("Succeeded to scan and get all the TV channels.");
                }, function onerror(error) {
                  alert(error);
                });

                break;
              case "stopped":
                alert("The scanning process is stopped.");
                break;
              default:
                break;
            }
          };

          // Ask the configured TV source to scan TV channels.
          currentSource.startScanning({
            isRescanned: true
          }).then(function onsuccess() {
            alert("The scanning process starts.");
          }, function onerror(error) {
            alert(error);
          });
        </pre>

        <p>
          The following example shows how to get all the available TV programs
          from the TV channel.
        </p>

        <pre class="example highlight">
          // Assuming a tuner has already been picked and its current source is
          // set, variable |currentSource| is used for following illustration.

          // Set the 'oneitbroadcasted' event handler.
          currentSource.oneitbroadcasted = function oneitbroadcasted(event) {
            var newPrograms = event.programs;

            // Add or update correspondent programs in |curProgramsOfChannels|
            // based on their |eventId|.
            ...
          };

          // Retrieve all the available TV channels from the configured TV
          // source of the TV tuner.
          currentSource.getChannels().then(function onsuccess(channels) {
            channels.forEach(function getProgramsByChannel(channel) {
              var channelNumber = channel.number;

              // Retrieve all the available TV programs from the TV channel.
              channel.getPrograms().then(function onsuccess(programs) {
                curProgramsOfChannels[channelNumber] = programs;
              }, function onerror(error) {
                alert(error);
              });
            });
          }, function onerror(error) {
            alert(error);
          });
        </pre>

        <p>
          The following example shows how to play the streaming data of a TV
          tuner by assigning the <code><a>MediaStream</a></code> to a
          <code><a>HTMLMediaElement</a></code>.
        </p>

        <pre class="example highlight">
          &lt;!DOCTYPE html&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;script&gt;
                // Retrieve all the currently available TV tuners first.
                navigator.tv.getTuners().then(function onsuccess(tuners) {
                  if (tuners.length == 0) {
                    return;
                  }

                  // Just use the first TV tuner.
                  var tuner = tuners[0];

                  var video = document.getElementById("video-player");
                  video.srcObject = tuner.stream;
                }, function onerror(error) {
                  alert(error);
                });
              &lt;/script&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;p&gt;&lt;video id="video-player" autoplay&gt;&lt;/video&gt;&lt;/p&gt;
            &lt;/body&gt;
          &lt;/html&gt;
        </pre>

        <p>
          The following example shows how to switch the TV channel with the
          channel number, and listen to events for channel changes.
        </p>

        <pre class="example highlight">
          // Assuming a tuner has already been picked and its current source is
          // set, variable |currentSource| is used for following illustration.

          // Retrieve all the available TV channels from the configured TV
          // source of the TV tuner.
          currentSource.getChannels().then(function onsuccess(channels) {
            if (channels.length == 0) {
              return;
            }

            // Just use the first TV channel.
            var channel = channels[0];
            var channelNumber = channel.number.

            currentSource.oncurrentchannelchanged = function oncurrentchannelchanged(event) {
              alert("The current channel has changed.");
            };

            // Switch the TV channel based on the TV channel number.
            currentSource.setCurrentChannel(channelNumber).then(function onsuccess() {
              alert("Succeeded to switch the TV channel.");
            }, function onerror(error) {
              alert(error);
            });
          }, function onerror(error) {
            alert(error);
          });
        </pre>

      </section>
    </section>
    
<!-- - - - - - - - - - - - - - - Conformance - - - - - - - - - - - - - - - - -->
    <section id="conformance">
      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn>user agent</dfn> that implements the interfaces that
        it contains.
      </p>
    
      <p>
        Implementations that use ECMAScript to implement the APIs defined in
        this specification MUST implement them in a manner consistent with the
        ECMAScript Bindings defined in the Web IDL specification [[!WEBIDL]], as
        this specification uses that specification and terminology.
      </p>
    </section>
    
<!-- - - - - - - - - - - - - - - Terminology  - - - - - - - - - - - - - - - -->
    <section>
      <h2>Terminology</h2>
      <p>
        The <dfn><a
        href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler">
        EventHandler</a></dfn> interface represents a callback used for event
        handlers as defined in [[!HTML5]].
      </p>

      <p>
        The concepts <dfn><a
        href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task"> queue
        a task</a></dfn> and <dfn><a
        href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
        fire an event</a></dfn> are defined in [[!HTML5]].
      </p>

      <p>
        The terms <a
        href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers"><dfn
        id="dfn-eventhandler">event handler</dfn></a> and <a
        href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
        <dfn id="dfn-eventtypes"> event handler event types</dfn></a> are
        defined in [[!HTML5]].
      </p>

      <p>
        The <dfn><a href="http://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects">Promise</a></dfn>
        interface, the concepts of a <a href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-resolve-functions"><dfn>resolver</dfn></a>, a
        <dfn id="dfn-fulfill-algorithm"><a
        href="http://people.mozilla.org/~jorendorff/es6-draft.html#sec-fulfillpromise"> resolver's
        fulfill algorithm</a></dfn> and a <dfn id="dfn-reject-algorithm"><a
        href="http://people.mozilla.org/~jorendorff/es6-draft.html#sec-rejectpromise"> resolver's
        reject algorithm</a></dfn> are defined in [[ECMAScript]].
      </p>

      <p>
        The <dfn><a href="http://www.w3.org/TR/mediacapture-streams/#mediastream">MediaStream</a></dfn>
        interface is defined in [[MediaCapture-Streams]].
      </p>

      <p>
        The <dfn><a href="http://www.w3.org/TR/mediastream-recording/#idl-def-MediaRecorder">MediaRecorder</a></dfn>
        interface is defined in [[MediaStream-Recording]].
      </p>

      <p>
        The <dfn><a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-video-element">video</a></dfn>
        and <dfn><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></dfn>
        elements are defined in [[!HTML5]].
      </p>
    </section>

<!-- - - - - - - - - - - - - Extended Interface Navigator  - - - - - - - - - -->
    <section>
      <h2><a>Navigator</a> Interface</h2>
        <dl title="partial interface Navigator" class="idl">
          <dt>readonly attribute TVManager tv</dt>
          <dd>
          MUST return the object that exposes the interface to the TV service.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - - - - - - Interface TVManager  - - - - - - - - - - - - - -->
    <section>
      <h2><a>TVManager</a> Interface</h2>
      <p>
        The <a>TVManager</a> interface represents a bunch of properties and
        a set of operations that can be used to manage the TV device.
      </p>

      <dl title="interface TVManager : EventTarget" class="idl">
        <dt>Promise getTuners ()</dt>
          <dd>
            This method makes a request to retrieve all the TV tuners that are
            available in the TV device. It returns a new <code><a>Promise</a></code>
            that will be used to notify the caller about the result of the
            operation, which is an array of <a>TVTuner</a> elements.
          </dd>
      </dl>

      <section>
        <h3>Steps</h3>

        <p>
          The <dfn><code>getTuners</code></dfn> method when invoked MUST run
          the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV device to retrieve all the TV tuners that
            are available in the TV device.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Let <var>tuners</var> be the array of the retrieved <a>TVTuner</a>
              elements.
            </li>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              with <em>tuners</em> as the <code>value</code> argument.
            </li>
          </ol>
        </ol>

      </section>

    </section>

<!-- - - - - - - - - - - - Interface TVTuner  - - - - - - - - - - - - -->
    <section>
      <h2><a>TVTuner</a> Interface</h2>
      <p>
        The <a>TVTuner</a> interface represents a bunch of properties and
        a set of operations related to the TV tuner.
      </p>
      <dl title="interface TVTuner : EventTarget" class="idl">

        <dt>sequence&lt;TVSourceType&gt; getSupportedSourceTypes ()</dt>
          <dd>
            MUST return the types of the supported TV sources.
          </dd>

        <dt>Promise getSources ()</dt>
          <dd>
            This method makes a request to retrieve all the TV sources that are
            available in the TV tuner. It returns a new <code><a>Promise</a></code>
            that will be used to notify the caller about the result of the
            operation, which is an array of <a>TVSource</a> elements that belong
            to the TV tuner.
          </dd>

        <dt>Promise setCurrentSource ()</dt>
          <dd>
            This method makes a request to configure the current TV source of
            the TV tuner by the <code>sourceType</code> parameter. It returns a
            new <code><a>Promise</a></code> that will be used to notify the caller
            about the result of the operation.
            <dl class='parameters'>
              <dt>TVSourceType sourceType</dt>
                <dd>
                  Specifies the TV source type for configuring the current TV
                  source.
                </dd>
            </dl>
          </dd>

        <dt>readonly attribute DOMString id</dt>
          <dd>
            MUST return the ID of the TV tuner.
          </dd>

        <dt>readonly attribute TVSource? currentSource</dt>
          <dd>
            MUST return the currently configured TV source. MUST return
            <em>null</em> if the TV source is not configured.
          </dd>

        <dt>readonly attribute MediaStream? stream</dt>
          <dd>
            MUST return a <code><a>MediaStream</a></code> object that is
            currently streamed by the TV tuner, which can be played by the
            <code><a>video</a></code> element by
            <a href="http://www.w3.org/TR/mediacapture-streams/#direct-assignment-to-media-elements">assigning</a>
            the <code><a>MediaStream</a></code> to the
            <code><a>HTMLMediaElement</a></code> and can be recorded by the
            <code><a>MediaRecorder</a></code>.
            MUST return <em>null</em> if the TV tuner is not streaming any data,
            which happens when the streaming signal is broken or due to any
            other reasons that the TV tuner fails to stream the data.
          </dd>

        <dt class="no-docs">
          attribute EventHandler oncurrentsourcechanged
        </dt>
          <dd>
            Handles the <code>oncurrentsourcechanged</code> event of type
            <a>TVCurrentSourceChangedEvent</a>, fired when the method
            <a><code>setCurrentSource</code></a> is invoked to configure the
            current TV source.
          </dd>
      </dl>

      <section>
        <h3>Steps</h3>

        <p>
          The <dfn><code>getSources</code></dfn> method when invoked MUST run
          the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV tuner to retrieve all the TV sources that
            are available in the TV tuner.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Let <var>sources</var> be the array of the retrieved
              <a>TVSource</a> elements.
            </li>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              with <em>channels</em> as the <code>value</code> argument.
            </li>
          </ol>
        </ol>

        <p>
          The <dfn><code>setCurrentSource</code></dfn> method when invoked MUST
          run the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV tuner to configure the current TV source
            according to the <code>sourceType</code> parameter.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              without assigning a value to the <code>value</code> argument.
            </li>
          </ol>
        </ol>
      </section>

      <section>
        <h2>Event handlers</h2>
        <p>The following are the <a class="internalDFN"
        href="#dfn-eventhandler">event handlers</a> (and their corresponding <a
        class="internalDFN" href="#dfn-eventtypes">event types</a>) that MUST be
        supported as attributes by the <a>TVTuner</a> object.

        <table class="simple">
          <thead>
            <tr>
              <th>Event handler</th>
              <th>Event name</th>
              <th>Event type</th>
              <th>Short description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong><code>oncurrentsourcechanged</code></strong></td>
              <td><code><dfn id="dfn-change-event">currentsourcechanged</dfn></code></td>
              <td><a><code>TVCurrentSourceChangedEvent</code></a></td>
              <td>
                Handles the information of the current TV source that is
                configured by the method <a><code>setCurrentSource</code></a>.
              </td>
            </tr>
          </tbody>
        </table>
      </section>

    </section>

<!-- - - - - - - - - - - - Interface TVSource  - - - - - - - - - - - - -->
    <section>
      <h2><a>TVSource</a> Interface</h2>
      <p>
        The <a>TVSource</a> interface represents a bunch of properties and a set
        of operations related to the TV source.
      </p>
      <dl title="interface TVSource : EventTarget" class="idl">

        <dt>Promise getChannels ()</dt>
          <dd>
            This method makes a request to retrieve all the TV channels that are
            available in the TV source. It returns a new <code><a>Promise</a></code>
            that will be used to notify the caller about the result of the
            operation, which is an array of <a>TVChannel</a> elements that
            belong to the TV source. Note that the <code><a>Promise</a></code> may be
            rejected with an <code>InvalidStateError</code> if this method gets
            called during channel scanning.
          </dd>

        <dt>Promise setCurrentChannel ()</dt>
          <dd>
            This method makes a request to tune the currently streamed TV
            channel by the <code>channelNumber</code> parameter. It returns a
            new <code><a>Promise</a></code> that will be used to notify the caller
            about the result of the operation. Note that the <code><a>Promise</a></code>
            may be rejected with an <code>InvalidStateError</code> if this
            method gets called during channel scanning.
            <dl class='parameters'>
              <dt>DOMString channelNumber</dt>
                <dd>
                  Specifies the TV channel number for tuning the currently
                  streamed TV channel.
                </dd>
            </dl>
          </dd>

        <dt>Promise startScanning ()</dt>
          <dd>
            This method makes a request to start scanning all the TV channels
            that are available in the TV source by the <code>options</code>
            parameter. It returns a new <code><a>Promise</a></code> that will be used
            to notify the caller about the result of the operation. Note that
            this method has to be called first so that the method
            <a><code>getChannels</code></a> can retrieve the channels that have
            successfully been scanned by the TV source.
            <dl class='parameters'>
              <dt>optional TVStartScanningOptions options</dt>
                <dd>
                  Specifies the options for scanning the TV channels. The
                  <code>isRescanned</code> option in the <code>options</code>
                  parameter specifies whether or not the process of scanning the
                  TV channels has to clear the currently scanned TV channels
                  before scanning; if it is not passed, this method will rescan
                  all the TV channels as if it is passed as <code>true</code>.
                </dd>
            </dl>
          </dd>

        <dt>Promise stopScanning ()</dt>
          <dd>
            This method makes a request to stop scanning the TV channels for the
            TV source. It returns a new <code><a>Promise</a></code> that will be used
            to notify the caller about the result of the operation.
          </dd>

        <dt>readonly attribute TVTuner tuner</dt>
          <dd>
            MUST return the TV tuner which the TV source belongs to.
          </dd>

        <dt>readonly attribute TVSourceType type</dt>
          <dd>
            MUST return the type of the TV source.
          </dd>

        <dt>readonly attribute boolean isScanning</dt>
          <dd>
            MUST indicate whether the TV source is scanning the TV channels or
            not.
          </dd>

        <dt>readonly attribute TVChannel? currentChannel</dt>
          <dd>
            MUST return the TV channel that is currently streamed by the TV
            tuner which owns the TV source. MUST return <em>null</em> if the TV
            tuner is not streaming any data.
          </dd>

        <dt class="no-docs">
          attribute EventHandler oncurrentchannelchanged
        </dt>
          <dd>
            Handles the <code>oncurrentchannelchanged</code> event of type
            <a>TVCurrentChannelChangedEvent</a>, fired when the method
            <a><code>setCurrentChannel</code></a> is invoked to tune the
            currently streamed TV channel.
          </dd>

        <dt class="no-docs">
          attribute EventHandler oneitbroadcasted
        </dt>
          <dd>
            Handles the <code>oneitbroadcasted</code> event of type
            <a>TVEITBroadcastedEvent</a>, fired when the Event Information Table
            (EIT) is broadcasted by the TV source.
          </dd>

        <dt class="no-docs">
          attribute EventHandler onscanningstatechanged
        </dt>
          <dd>
            Handles the <code>onscanningstatechanged</code> event of type
            <a>TVScanningStateChangedEvent</a>, fired when the state of scanning
            the TV channels is changed by the TV source. E.g., it can be fired
            when the method <a><code>startScanning</code></a> or the method
            <a><code>stopScanning</code></a> starts or stops scanning the TV
            channels.
          </dd>
      </dl>

      <section>
        <h3>Steps</h3>

        <p>
          The <dfn><code>getChannels</code></dfn> method when invoked MUST run
          the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV source to retrieve all the TV channels that
            are available in the TV source.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Let <var>channels</var> be the array of the retrieved
              <a>TVChannel</a> elements.
            </li>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              with <em>channels</em> as the <code>value</code> argument.
            </li>
          </ol>
        </ol>

        <p>
          The <dfn><code>setCurrentChannel</code></dfn> method when invoked MUST
          run the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV source to tune the currently streamed TV
            channel according to the <code>channelNumber</code> parameter.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              without assigning a value to the <code>value</code> argument.
            </li>
          </ol>
        </ol>

        <p>
          The <dfn><code>startScanning</code></dfn> method when invoked MUST
          run the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV source to start scanning all the TV
            channels that are available in the TV source according to the
            scanning options specified in the <code>options</code> parameter. If
            the <code>isRescanned</code> option in the <code>options</code>
            parameter is not passed or it is passed as <code>true</code>, the
            <a class="internalDFN" href="#dfn-user-agent">user agent</a> has to
            clear the currently scanned TV channels before scanning; if it is
            passed as <code>false</code>, the
            <a class="internalDFN" href="#dfn-user-agent">user agent</a> will
            simply scan additional TV channels which haven't been scanned yet.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              without assigning a value to the <code>value</code> argument.
            </li>
          </ol>
        </ol>

        <p>
          The <dfn><code>stopScanning</code></dfn> method when invoked MUST run
          the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV source to stop scanning the TV channels.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              without assigning a value to the <code>value</code> argument.
            </li>
          </ol>
        </ol>

      </section>

      <section>
        <h2>Event handlers</h2>
        <p>The following are the <a class="internalDFN"
        href="#dfn-eventhandler">event handlers</a> (and their corresponding <a
        class="internalDFN" href="#dfn-eventtypes">event types</a>) that MUST be
        supported as attributes by the <a>TVSource</a> object.

        <table class="simple">
          <thead>
            <tr>
              <th>Event handler</th>
              <th>Event name</th>
              <th>Event type</th>
              <th>Short description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong><code>oncurrentchannelchanged</code></strong></td>
              <td><code><dfn id="dfn-change-event">currentchannelchanged</dfn></code></td>
              <td><a><code>TVCurrentChannelChangedEvent</code></a></td>
              <td>
                Handles the information of the currently streamed TV channel
                that is tuned by the method
                <a><code>setCurrentChannel</code></a>.
              </td>
            </tr>

            <tr>
              <td><strong><code>oneitbroadcasted</code></strong></td>
              <td><code><dfn id="dfn-change-event">eitbroadcasted</dfn></code></td>
              <td><a><code>TVEITBroadcastedEvent</code></a></td>
              <td>
                Handles the information of the available TV programs in the EIT
                that is broadcasted by the TV source.
              </td>
            </tr>

            <tr>
              <td><strong><code>onscanningstatechanged</code></strong></td>
              <td><code><dfn id="dfn-change-event">scanningstatechanged</dfn></code></td>
              <td><a><code>TVScanningStateChangedEvent</code></a></td>
              <td>
                Handles the information of the state of scanning the TV
                channels, which is changed by the TV source.
              </td>
            </tr>

          </tbody>
        </table>
      </section>

    </section>

<!-- - - - - - - - - - - - Interface TVChannel  - - - - - - - - - - - - -->
    <section>
      <h2><a>TVChannel</a> Interface</h2>
      <p>
        The <a>TVChannel</a> interface represents a bunch of properties and
        a set of operations related to the TV channel.
      </p>
      <dl title="interface TVChannel : EventTarget" class="idl">

        <dt>Promise getPrograms ()</dt>
          <dd>
            This method makes a request to retrieve all the TV programs that are
            available in the TV channel by the <code>options</code> parameter.
            It returns a new <code><a>Promise</a></code> that will be used to notify
            the caller about the result of the operation, which is an array of
            <a>TVProgram</a> elements that belong to the TV channel.
            <dl class='parameters'>
              <dt>optional TVGetProgramsOptions options</dt>
                <dd>
                  Specifies the options for retrieving the TV programs. If this
                  parameter is not passed, this method will retuen all the
                  available TV programs.
                </dd>
            </dl>
          </dd>

        <dt>Promise getCurrentProgram ()</dt>
          <dd>
            This method makes a request to retrieve the current TV program
            available in the TV channel. It returns a new <code><a>Promise</a></code>
            that will be used to notify the caller about the result of the
            operation, which is a <a>TVProgram</a> element that belongs to the
            TV channel.
          </dd>

        <dt>readonly attribute DOMString networkId</dt>
          <dd>
            MUST return the identification of a broadcast transmission network.
            On satellite and IP broadband, typically one <code>networkId</code>
            corresponds to an operator. On cable and terrestrial, where
            different radio frequencies might be used in different regions,
            operators typically use one <code>networkId</code> per such region.
          </dd>

        <dt>readonly attribute DOMString transportStreamId</dt>
          <dd>
            MUST return the identification of a time-domain multiplex of several
            programmes carried in Transport Stream (TS) packets. One or more
            multiplexes can be transmitted on any given radio frequency in a DVB
            network.
          </dd>

        <dt>readonly attribute DOMString serviceId</dt>
          <dd>
            MUST return the identification of a TV, radio or data programme
            within a TS multiplex. The number of programmes is limited by the
            capacity of the underlying physical channel.
          </dd>

        <dt>readonly attribute TVSource source</dt>
          <dd>
            MUST return the TV source which the TV channel belongs to.
          </dd>

        <dt>readonly attribute TVChannelType type</dt>
          <dd>
            MUST return the type of the TV channel.
          </dd>

        <dt>readonly attribute DOMString name</dt>
          <dd>
            MUST return the name of the TV channel. E.g., <code>"CNN"</code>,
            <code>"NHK"</code>... etc.
          </dd>

        <dt>readonly attribute DOMString number</dt>
          <dd>
            MUST return the Logical Channel Number (LCN) of the TV channel.
            E.g., <code>"12-1"</code>, <code>"12-2"</code>,
            <code>"12-2"</code>... etc.
          </dd>

        <dt>readonly attribute boolean isEmergency</dt>
          <dd>
            MUST indicate whether the TV channel is for the emergency purpose.
          </dd>

        <dt>readonly attribute boolean isFree</dt>
          <dd>
            MUST indicate whether the TV channel is free to watch.
          </dd>

      </dl>

      <section>
        <h3>Steps</h3>

        <p>
          The <dfn><code>getPrograms</code></dfn> method when invoked
          MUST run the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV channel to retrieve all the TV programs
            that are available in the TV channel according to the retrieving
            options specified in the <code>options</code> parameter.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Let <var>programs</var> be the array of the retrieved
              <a>TVProgram</a> elements.
            </li>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              with <em>programs</em> as the <code>value</code> argument.
            </li>
          </ol>
        </ol>

        <p>
          The <dfn><code>getCurrentProgram</code></dfn> method when invoked
          MUST run the following steps:
        </p>
        <ol>
          <li>
            Let <var>promise</var> be a new <code><a>Promise</a></code> object and
            <var>resolver</var> be its associated <code>resolver</code>.
          </li>
          <li>
            Return <var>promise</var> to the caller.
          </li>
          <li>
            Make a request to the TV channel to retrieve all the current TV
            program available in the TV channel.
          </li>
          <li>
            If an <var>error</var> occurs invoke <em>resolver</em>'s <a
            class="internalDFN" href="#dfn-reject-algorithm">reject algorithm</a>
            with <em>error</em> as the <code>value</code> argument.
          </li>
          <li>
            When the request has been successfully completed:
          </li>
          <ol>
            <li>
              Let <var>program</var> be the retrieved <a>TVProgram</a> element.
            </li>
            <li>
              Invoke <em>resolver</em>'s <a
              class="internalDFN" href="#dfn-fulfill-algorithm"> fulfill algorithm</a>
              with <em>program</em> as the <code>value</code> argument.
            </li>
          </ol>
        </ol>

      </section>

    </section>

<!-- - - - - - - - - - - - Interface TVProgram  - - - - - - - - - - - - -->
    <section>
      <h2><a>TVProgram</a> Interface</h2>
      <p>
        The <a>TVProgram</a> interface represents a bunch of properties and
        a set of operations related to the TV program.
      </p>
      <dl title="interface TVProgram" class="idl">
        <dt>sequence&lt;DOMString&gt; getAudioLanguages ()</dt>
          <dd>
            MUST return the audio languages of the TV program in 3-digit
            language codes specified by ISO 639-2.
          </dd>

        <dt>sequence&lt;DOMString&gt; getSubtitleLanguages ()</dt>
          <dd>
            MUST return the subtitle languages of the TV program in 3-digit
            language codes specified by ISO 639-2.
          </dd>

        <dt>readonly attribute DOMString eventId</dt>
          <dd>
            MUST return the event ID of the TV program. It has to be unique only
            within a TV channel.
          </dd>

        <dt>readonly attribute TVChannel channel</dt>
          <dd>
            MUST return the TV channel which the TV program belongs to.
          </dd>

        <dt>readonly attribute DOMString title</dt>
          <dd>
            MUST return the title of the TV program.
          </dd>

        <dt>readonly attribute unsigned long long startTime</dt>
          <dd>
            MUST return the start time of the TV program.
          </dd>

        <dt>readonly attribute unsigned long long duration</dt>
          <dd>
            MUST return the duration of the TV program.
          </dd>

        <dt>readonly attribute DOMString? description</dt>
          <dd>
            MUST return the description of the TV program.
          </dd>

        <dt>readonly attribute DOMString? rating</dt>
          <dd>
            MUST return the rating of the TV program.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - - - - - Dictionary TVStartScanningOptions   - - - - - - - -->
    <section>
      <h2><a>TVStartScanningOptions</a> Dictionary</h2>
      <p>
        The <a>TVStartScanningOptions</a> dictionary contains the information
        for scanning the TV channels.
      </p>
      <dl title="dictionary TVStartScanningOptions" class="idl">
        <dt>boolean isRescanned</dt>
          <dd>
            Specifies whether or not the process of scanning the TV channels has
            to clear the currently scanned TV channels before scanning.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - - - Dictionary TVGetProgramsOptions   - - - - - - - - - -->
    <section>
      <h2><a>TVGetProgramsOptions</a> Dictionary</h2>
      <p>
        The <a>TVGetProgramsOptions</a> dictionary contains the information for
        retrieving the TV programs.
      </p>
      <dl title="dictionary TVGetProgramsOptions" class="idl">
        <dt>unsigned long offsetOfPrograms</dt>
          <dd>
            Specifies how many TV programs to be skipped from the time point
            of now. E.g., if this option is passed as <code>1</code>, the
            method will skip the current TV program and return the ones starting
            with the next TV program.
          </dd>
        <dt>unsigned long numberOfPrograms</dt>
          <dd>
            Specifies how many TV programs to be retrieved from the time point
            of now. E.g., if this option is passed as <code>1</code>, the
            method will return the TV program that is currently broadcasted by
            the TV channel at this moment; if it is passed as <code>2</code>,
            the method will return the current and the next TV programs. Passing
            0 implies no effect. Besides, the number of returned TV programs
            could be less than this value if there are not that many programs.
          </dd>
        <dt>unsigned long long startTime</dt>
          <dd>
            Specifies the start time of a time period which bounds the time
            slots of TV programs to be retrieved.
          </dd>
        <dt>unsigned long long duration</dt>
          <dd>
            Specifies the duration of a time period which bounds the time slots
            of TV programs to be retrieved.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - Interface TVCurrentSourceChangedEvent - - - - - - - - - -->
    <section>
      <h2><a>TVCurrentSourceChangedEvent</a> Interface</h2>
      <p>
        The <a>TVCurrentSourceChangedEvent</a> interface represents the event
        related to the current TV source that is configured by the method
        <a><code>setCurrentSource</code></a>.
      </p>
      <dl title="interface TVCurrentSourceChangedEvent : Event" class="idl">
        <dt>readonly attribute TVSource? source</dt>
          <dd>
            MUST return the TV source that is currently configured by the TV
            tuner. MUST return <em>null</em> if the TV source is not configured.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - - - - - Interface TVEITBroadcastedEvent - - - - - - - - -->
    <section>
      <h2><a>TVEITBroadcastedEvent</a> Interface</h2>
      <p>
        The <a>TVEITBroadcastedEvent</a> interface represents the event related
        to the available TV programs in the EIT that is broadcasted by the TV
        source.
      </p>
      <dl title="interface TVEITBroadcastedEvent : Event" class="idl">
        <dt>readonly attribute object programs</dt>
          <dd>
            MUST return the available TV programs in the EIT that is broadcasted
            by the TV source. Please note that the cached value for this array
            needs to go into an internal slot for the object, and it should be
            cached there until the next time that the underlying array changes
            when the cached value will be updated.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - - - Interface TVScanningStateChangedEvent - - - - - - - - -->
    <section>
      <h2><a>TVScanningStateChangedEvent</a> Interface</h2>
      <p>
        The <a>TVScanningStateChangedEvent</a> interface represents the event
        related to the state of scanning the TV channels, which is changed by
        the TV source.
      </p>
      <dl title="interface TVScanningStateChangedEvent : Event" class="idl">
        <dt>readonly attribute TVScanningState state</dt>
          <dd>
            MUST return the state of scanning the TV channels, which is changed
            by the TV source.
          </dd>

        <dt>readonly attribute TVChannel? channel</dt>
           <dd>
            MUST return the TV channel that is scanned by the TV source. MUST
            return <em>null</em> if the <code>state</code> is not specified as
            <code>"scanned"</code>.
           </dd>
      </dl>
    </section>

<!-- - - - - - - - Interface TVCurrentChannelChangedEvent - - - - - - - - - -->
    <section>
      <h2><a>TVCurrentChannelChangedEvent</a> Interface</h2>
      <p>
        The <a>TVCurrentChannelChangedEvent</a> interface represents the event
        related to the currently streamed TV channel that is tuned by the method
        <a><code>setCurrentChannel</code></a>.
      </p>
      <dl title="interface TVCurrentChannelChangedEvent : Event" class="idl">
        <dt>readonly attribute TVChannel? channel</dt>
          <dd>
            MUST return the TV channel that is currently streamed by the TV
            tuner. MUST return <em>null</em> if the TV tuner is not streaming
            any data.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - - - - - Interface Enumerations  - - - - - - - - - - - - - -->
    <section>
      <h2>Enumerations</h2>
      <p>
        The attribute <code>type</code> in the <a>TVSource</a> can have the
        following values:
      </p>
      <dl title="enum TVSourceType" class="idl">
        <dt>dvb-t</dt>
          <dd>
            The TV source works for DVB-T (terrestrial).
          </dd>

        <dt>dvb-t2</dt>
          <dd>
            The TV source works for DVB-T2 (terrestrial).
          </dd>

        <dt>dvb-c</dt>
          <dd>
            The TV source works for DVB-C (cable).
          </dd>

        <dt>dvb-c2</dt>
          <dd>
            The TV source works for DVB-C2 (cable).
          </dd>

        <dt>dvb-s</dt>
          <dd>
            The TV source works for DVB-S (satellite).
          </dd>

        <dt>dvb-s2</dt>
          <dd>
            The TV source works for DVB-S2 (satellite).
          </dd>

        <dt>dvb-h</dt>
          <dd>
            The TV source works for DVB-H (handheld).
          </dd>

        <dt>dvb-sh</dt>
          <dd>
            The TV source works for DVB-SH (satellite).
          </dd>

        <dt>atsc</dt>
          <dd>
            The TV source works for ATSC (terrestrial/cable).
          </dd>

        <dt>atsc-m/h</dt>
          <dd>
            The TV source works for ATSC-M/H (mobile/handheld).
          </dd>

        <dt>isdb-t</dt>
          <dd>
            The TV source works for ISDB-T (terrestrial).
          </dd>

        <dt>isdb-tb</dt>
          <dd>
            The TV source works for ISDB-Tb (terrestrial, Brazil).
          </dd>

        <dt>isdb-s</dt>
          <dd>
            The TV source works for ISDB-S (satellite).
          </dd>

        <dt>isdb-c</dt>
          <dd>
            The TV source works for ISDB-C (cable).
          </dd>

        <dt>1seg</dt>
          <dd>
            The TV source works for 1seg (handheld).
          </dd>

        <dt>dtmb</dt>
          <dd>
            The TV source works for DTMB (terrestrial).
          </dd>

        <dt>cmmb</dt>
          <dd>
            The TV source works for CMMB (handheld).
          </dd>

        <dt>t-dmb</dt>
          <dd>
            The TV source works for T-DMB (terrestrial).
          </dd>

        <dt>s-dmb</dt>
          <dd>
            The TV source works for S-DMB (satellite).
          </dd>

      </dl>

      <p>
        The attribute <code>type</code> in a <a>TVChannel</a> can have the
        following values:
      </p>
      <dl title="enum TVChannelType" class="idl">
        <dt>tv</dt>
          <dd>
            The TV channel is broadcasted as a regular TV type.
          </dd>

        <dt>radio</dt>
          <dd>
            The TV channel is broadcasted as a radio type.
          </dd>

        <dt>data</dt>
          <dd>
            The TV channel is broadcasted as a data type.
          </dd>
      </dl>

      <p>
        The attribute <code>state</code> in the
        <a>TVScanningStateChangedEvent</a> can have the following values:
      </p>
      <dl title="enum TVScanningState" class="idl">
        <dt>cleared</dt>
          <dd>
            The state of scanning the TV channels is cleared by the TV source,
            which means all the currently scanned TV channels are cleared before
            scanning.
          </dd>

        <dt>scanned</dt>
          <dd>
            The state of scanning the TV channels is scanned, which means a TV
            channel is successfully scanned by the TV source.
          </dd>

        <dt>completed</dt>
          <dd>
            The state of scanning the TV channels is completed by the TV source.
          </dd>

        <dt>stopped</dt>
          <dd>
            The state of scanning the TV channels is stopped by the TV source.
          </dd>
      </dl>
    </section>

<!-- - - - - - - - - - - - Acknowledgements  - - - - - - - - - - - - - - - - -->
    <section>
      <h2>Acknowledgements</h2>
      <p>
        To be constructed.
      </p>
    </section>

  </body>
</html>

